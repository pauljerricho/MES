<?php
require_once("$_SERVER[DOCUMENT_ROOT]/../lib/lib_road.inc");
?>
<!DOCTYPE html>
<html>
<head> 
<meta charset="utf-8">
<title>PHP 프로그래밍 입문</title>
</head>
<body>
<?php
$userid = $_GET['id'];
$subject = $_POST['subject'];
$content = $_POST['content'];
$subject = htmlspecialchars($subject, ENT_QUOTES);
$content = htmlspecialchars($content, ENT_QUOTES);
$regist_day = date("Y-m-d (H:i)");


$lib->lib_fun("message");
$lib->lib_fun("value_check2");
if(!$value_check2->value_check2_(array($subject,$content))){
    $message->message_("인자가 부족하여 처리 할 수 없습니다.","history.back();","exit");
}

$lib->lib_fun('session_chk');
$session_chk->session_chk_(array($_SESSION['userid']),"로그인후 이용해주세요!","location.href='/index.php';","");

$lib->lib("file_name_strstr");
$file_name_strstr->file_name_strstr_(array("upfile").".gif,.jpg,.jpeg,.png");

$upfile_name = $_FILES["upfile"]["name"];
$upfile_type = $_FILES["upfile"]["type"];

$lib->lib_fun("file_upload");
$copied_file_name = $file_upload->file_upload_("upfile",'./data',date("Y_m_H_i_s"));

$regist_day = date("Y-m-d (H:i)");

$lib->lib_fun("db_connect");
$db_connect->db_connect_();

$lib->lib_fun("dbi_insert");
$sql = $dbi_insert->dbi_insert_("board","id,name,subject,content,regist_day,hit,file_name,file_type,file_copied","'$userid','$_SESSION[username]','$subject','$content','$regist_day',0,'$upfile_name','$upfile_type','$copied_file_name'");

$point_up = 100;

$lib->lib_fun("dbi_ione_row_return");
$row = $data_ione_row_return->data_ione_row_return_("point","members","id='$_SESSION[userid]'");

$db_connect->db_close();

if($sql){
    $message->message_("입력 중 오류가 발생되었습니다.","history.back();","exit");
}else{
    $message->nomessage_("location.href='/bd_list.php';","exit");
}
?>
</body>
</html>
