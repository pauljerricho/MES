<!DOCTYPE html>
<html lang="en">
<head>
<title>수주조회 수정</title>
<?include "$_SERVER[DOCUMENT_ROOT]/inc/head_html_text.html";?>
<meta charset="UTF-8">
<link rel="stylesheet" href="/css/obtain_order.css">
<style>
.lack {
    background:#dd9379 !important;
}
@media screen and (max-width: 600px){
    #myform .input_calendar{
        width:90% !important;
    }
}
</style>
<script>
$(document).ready(function(){
	/*js 스크립트 불러오기*/
	js_reonload_src("datepicker");
	javascript_onload_src("script_next_focus");
	
	/*URL 파라미터 가져오기*/
	const urlParams = new URLSearchParams(location.search);
	var s_no = urlParams.get("s_no");
	
	/*FORM 태그 삽입하기*/
	script_new_reformdata(".sub_con","myform","","");
	$('#myform').append($('<input/>',{type:'hidden',name:'s_no',value:s_no}));
	$('#myform').append($('<input/>',{type:'hidden',name:'re_mt_number',value:''}));
	$('#myform').append($('<input/>',{type:'hidden',name:'re_quantity',value:''}));
	$('#myform').append($('<input/>',{type:'hidden',name:'tip_index',id:'tip_index',value:''}));



	//납기일자 높이설정
	if($(window).width()>768){
		$("#due_table").css("height",$("#order_table").outerHeight());
	}
	
	//발주자
	javascript_onload_src("script_ajax_layer_pop");
	$("#myform").on("click", "#c_name", function() {
		script_ajax_layer_pop('/obtain_order/popup_guest.html',jQuery('#myform').serialize(),'.popup-31');
	});
	
	//납품처 주소
	$("#myform").on("focus", "#od_post", function() {
		script_ajax_layer_pop('/popup/popup_home.html','post=od_post&address=od_address','.popup-31');
	});
	
	//발주자 체크
	$("#myform").on("click", ".mt_number, .p_name, .standard, .p_unit, .box_quantity, .sacks_unit", function() {
		script_ajax_layer_pop('/obtain_order/popup_product.html', jQuery('#myform').serialize(), '.popup-31');
	});
	
	//수정 버튼
	$("#myform .bot_btn > .save").click(function(){
		location.href='/obtain_order/pr_or_check.html';
	});
	
	//데이터테이블
	$("#table thead tr").prepend("<th>상세</th>");
	$("#table tbody tr").prepend("<td>상세</td>");
	var table = $("#table").DataTable({
		lengthChange : false, // 표시 건수기능 숨기기
		searching : false, // 검색 기능 숨기기
		ordering : false, // 정렬 기능 숨기기
		info : false, // 정보 표시 숨기기
		processing : false, // 페이징 기능 숨기기
		serverMethod : 'post',
		order : [ 1, "desc" ],
		dataType : "json",
		paging : false,
		pageLength : 10,
		pagingType : "full_numbers",
		dom : 'rt<"bottom"iflp>',
		language : {
	        "emptyTable": "데이터가 없습니다.",
	        "lengthMenu": "페이지당 _MENU_ 개씩 보기",
	        "info": "현재 _START_ - _END_ / _TOTAL_건",
	        "infoEmpty": "데이터 없음",
	        "infoFiltered": "( _MAX_건의 데이터에서 필터링되었습니다. )",
	        "search": "",
	        "zeroRecords": "일치하는 데이터가 없습니다.",
	        "loadingRecords": "로딩중...",
	        "processing":  false,
	        "paginate": {
	            "next": "다음",
	            "previous": "이전",
	            "first": '처음',
	            "last": '끝'
	        }
		},
		responsive: {
            details: {
                type: 'column'
            }
        },
        columnDefs: [ {
            className: 'control',
            orderable: false,
            targets:   0
        }]
	});
	
	new $.fn.dataTable.Responsive( table );
	
	//추가버튼 
	$('#add_row2').on( 'click', function () {
		draw_row(table);
	});
	
	//삭제버튼
	$("#myform").on("click", ".btn_plma", function(){
		table.row($(this).parents('tr')).remove().draw();
		no_display();
	});
	
	
	
	//데이터 출력(추후 ajax로 변경)
	$("#myform input[name='s_date']").val("2022-02-22");
    $("#myform input[name='e_date']").val("2022-03-21");
    $("#myform input[name='bank']").val("신한은행");
    $("#myform input[name='account_num']").val("100-016-161666");
    $("#myform input[name='account_name']").val("(주)명리");
	$("#myform input[name='od_post']").val("08589");
	$("#myform input[name='od_address']").val("서울특별시 금천구 가산디지털1로 75-24(가산동)");
	$("#myform input[name='od_address2']").val("1514호");
	$("#myform input[name='c_name']").val("제일식품");
	$("#myform input[name='cu_code']").val("CUS-0001");
	$("#myform input[name='cu_businessnum']").val("826-88-00583");
	$("#myform input[name='cu_username']").val("이한진");
	$("#myform input[name='cu_address']").val("서울특별시 영등포구 당산로 41길 11(당산동4가) SK V1center E동 B114호");
	$("#myform input[name='cu_tel1']").val("010");
	$("#myform input[name='cu_tel2']").val("8274");
	$("#myform input[name='cu_tel3']").val("7744");
	$("#myform input[name='cu_fax1']").val("02");
	$("#myform input[name='cu_fax2']").val("711");
	$("#myform input[name='cu_fax3']").val("3369");
	$("#myform input[name='cu_manager']").val("이정규");
	$("#myform input[name='ma_hp1']").val("010");
	$("#myform input[name='ma_hp2']").val("7415");
	$("#myform input[name='ma_hp3']").val("5089");
	$("#myform input[name='ma_email1']").val("ljguu");
	$("#myform input[name='ma_email2']").val("naver.com");
		
	var v = {"od_no":"1","p_name":"WAN-0001","mt_number":"명절선물세트","quantity":"10,000","quantity2":"1","quantity3":"333","p_price":"100,000","price_sum":"33,300,000","vat_sum":"3,330,000","total_sum":"36,600,000","box_quantity":"30","sacks_unit":"100","p_unit":"kg","standard":"ST","sum":"150,000"};
	table.row().remove().draw();
	draw_row(table,v);
	
	headerFixed();
	no_display();
});
function draw_row(table,data){
	if(!data){
		var data = new Array();
		data = {"od_no":"","p_name":"","mt_number":"","quantity":"","quantity2":"","quantity3":"","p_price":"","price_sum":"","vat_sum":"","total_sum":"","box_quantity":"","sacks_unit":"","p_unit":"","standard":"","sum":""};
	}else{
		!data['od_no'] ? data['od_no']="" : false;
		!data['p_name'] ? data['p_name']="" : false;
		!data['mt_number'] ? data['mt_number']="" : false;
		!data['quantity'] ? data['quantity']="" : false;
		!data['quantity2'] ? data['quantity2']="" : false;
		!data['quantity3'] ? data['quantity3']="" : false;
		!data['p_price'] ? data['p_price']="" : false;
		!data['price_sum'] ? data['price_sum']="" : false;
		!data['vat_sum'] ? data['vat_sum']="" : false;
		!data['total_sum'] ? data['total_sum']="" : false;
		!data['box_quantity'] ? data['box_quantity']="" : false;
		!data['sacks_unit'] ? data['sacks_unit']="" : false;
		!data['p_unit'] ? data['p_unit']="" : false;
		!data['standard'] ? data['standard']="" : false;
		!data['sum'] ? data['sum']="0" : false;
	}
	var req_stock = 0;
	if(Number(data.quantity) > Number(data.sum)){
		req_stock = Number(data.quantity) - Number(data.sum);
	}
	
	table.row.add([
		"<td class='control' tabindex='0'>상세</td>",
        "<div class='btn_plma btn_number' title='제거'>-</div><input type='hidden' name='od_no[]' value='"+data['od_no']+"'>",
        "<input type='text' class='mt_number' name='mt_number[]' value='"+data['mt_number']+"' readonly><input type='text' class='p_name' name='p_name[]' value='"+data['p_name']+"' readonly>",
        "<input type='text' class='standard' value='"+data['standard']+"' readonly><input type='text' class='p_unit' value='"+data['p_unit']+"' readonly>",
        "<input type='text' class='sacks_unit' value='"+data['sacks_unit']+"' readonly><input type='text' class='box_quantity' value='"+data['box_quantity']+"' readonly>",
        "<input type='text' class='quantity3' name='quantity3[]' value='"+data['quantity3']+"'>",
        "<input type='text' class='quantity2' name='quantity2[]' value='"+data['quantity2']+"'>",
        "<input type='text' class='quantity' name='quantity[]' value='"+data['quantity']+"'>",
        "<input type='text' class='p_price' name='p_price[]' value='"+data['p_price']+"' readonly>",
        "<input type='text' class='price_sum' name='price_sum[]' value='"+data['price_sum']+"' readonly>",
        "<input type='text' class='vat_sum' name='vat_sum[]' value='"+data['vat_sum']+"' readonly>",
        "<input type='text' class='total_sum' name='total_sum[]' value='"+data['total_sum']+"' readonly>",
        "<input type='text' class='stock' value='"+data['sum']+"' readonly><input type='text' class='req_stock' value='"+req_stock+"' readonly>"
    ]).draw(false);
	no_display();
}
function no_display(){ // 행 삭제 - 숫자입력
	var a1 = $('.btn_number').length;
	for(var i=1;i<=a1;i++){
		$('.btn_number').eq(i-1).text(i);
	}
}
function headerFixed(){
	//리스트 상단 헤더 고정
	var winWidth = $(document).width();
	var menuOffset = $("#table thead").offset();
	var tableWidth = $("#table").innerWidth();
	var colArr = [0,5,8,8,8,8,8,8,8,8,8,8,8,7];
	$("#table thead").css("width",tableWidth);
	$("#table thead tr th").each(function(i,v){
		var colWidth = tableWidth * colArr[i] / 100;
		$(this).css("width",colWidth+"px");
	});
	if(winWidth>768){
		$(window).scroll(function() {
			if($(document).scrollTop() > menuOffset.top) {
				$("#table thead").addClass('menuFixed');
			}else{
				$("#table thead").removeClass('menuFixed');
			}
		});
	}
}
</script>
</head>
<body>
	<div class="background"></div>
	<div class="header_wrap">
		<!--header-->
		<?include "$_SERVER[DOCUMENT_ROOT]/inc/header.html";?>
		<!--header-->
	</div>
	<!--header_wrap-->
	<!-- 퀵바 -->
	<div class="quick_wrap ui-draggable ui-draggable-handle">
	<?include "$_SERVER[DOCUMENT_ROOT]/inc/q_menu.html";?>
	</div>
	<!-- quick_wrap -->
	<?include "$_SERVER[DOCUMENT_ROOT]/inc/m_menu.html";?>
	<!--m_menu-->
	<div class="content">
		<?include "$_SERVER[DOCUMENT_ROOT]/inc/left_menu.html";?>
		<div class="content_detail" id="content_detail">
			<div id="content" class="prOrCheckRegCont">
				<!--side_bar-->
				<ul class="lnb">
					<li><a href="/index.html"><img src="/img/icon_home.jpg" alt="홈으로"></a></li>
					<li></li>
					<li><a href="/obtain_order/main.html">수주관리</a></li>
					<li></li>
					<li><a href="/obtain_order/pr_or_check.html">수주조회</a></li>
				</ul>
				<!--lnb-->
				<div class="sub_con">
					<h2 class="sub_tit" style="margin-bottom:20px;">수주 수정</h2>
					<!-- 발주자 -->
					<table class="tag_table" id="order_table" style="width: 50%;">
						<tbody>
							<tr>
								<th colspan="4" class="tag_th_st"><span>발주자</span></th>
							</tr>
							<tr>
								<th>상호</th>
								<td colspan="3">
									<input type="text" class="insearch" name="c_name" id="c_name" readonly>
									<input type="hidden" name="cu_code" id="cu_code">
								</td>
							</tr>
							<tr>
								<th>사업자번호</th>
								<td><input type="text" name="cu_businessnum" id="cu_businessnum"></td>
								<th>성명</th>
								<td><input type="text" name="cu_username" id="cu_username"></td>
							</tr>
							<tr>
								<th>연락처</th>
								<td class="input_num">
									<input type="text" maxlength="3" id='cu_tel1' name='cu_tel1' onkeyup="script_next_focus(this,3,document.myform.cu_tel2)">
									<p class="input_line">-</p>
									<input type="text" maxlength="4" id='cu_tel2' name='cu_tel2' onkeyup="script_next_focus(this,4,document.myform.cu_tel3)">
									<p class="input_line">-</p>
									<input type="text" maxlength="4" id='cu_tel3' name='cu_tel3'>
								</td>
								<th>FAX</th>
								<td class="input_num">
									<input type="text" maxlength="3" id='cu_fax1' name='cu_fax1' onkeyup="script_next_focus(this,3,document.myform.cu_fax2)">
									<p class="input_line">-</p>
									<input type="text" maxlength="4" id='cu_fax2' name='cu_fax2' onkeyup="script_next_focus(this,4,document.myform.cu_fax3)">
									<p class="input_line">-</p>
									<input type="text" maxlength="4" id='cu_fax3' name='cu_fax3'>
								</td>
							</tr>
							<tr>
								<th>주소</th>
								<td colspan="3"><input type="text" name="cu_address" id="cu_address" style="width: 84%;"></td>
							</tr>
		
							<tr>
								<th>담당자</th>
								<td colspan="3">
									<input type="text" name="cu_manager" id="cu_manager" value="">
									<label for="manager_ck2"><input type="checkbox" id="manager_ck2" name="manager_ck2" value="ok"> 발주자정보 자동업데이트 (담당자명/번호/이메일)</label>
								</td>
							</tr>
							<tr>
								<th>담당자번호</th>
								<td class="input_num">
									<input type="text" maxlength="3" id='ma_hp1' name='ma_hp1' onkeyup="script_next_focus(this,3,document.myform.ma_hp2)">
									<p class="input_line">-</p>
									<input type="text" maxlength="4" id='ma_hp2' name='ma_hp2' onkeyup="script_next_focus(this,4,document.myform.ma_hp3)">
									<p class="input_line">-</p>
									<input type="text" maxlength="4" id='ma_hp3' name='ma_hp3' onkeyup="script_next_focus(this,4,document.myform.ma_email1)">
								</td>
								<th>이메일</th>
								<td class="email_input">
									<input name="ma_email1" type="text" id='ma_email1'>
									<p class="email_line">@</p>
									<input name="ma_email2" type="text" id='ma_email2'>
								</td>
							</tr>
						</tbody>
					</table>
					<table class="tag_table" id="due_table" style="width:50%;">
						<tbody>
							<tr>
								<th colspan="8" class="tag_th_st"><span>납기정보</span></th>
							</tr>
							<tr>
								<th colspan="1">수주일자</th>
								<td colspan="3">
									<input type="text" class="btn_candle input_calendar" name="s_date">
								</td>
								<th colspan="1">납기일자</th>
								<td colspan="3">
									<input type="text" class="btn_candle input_calendar" name="e_date">
								</td>
							</tr>
							<tr>
								<th>입금계좌정보</th>
								<td colspan="7">
									<div class="bank_box">
										<span>은행명</span>
										<input type="text" id="bank" name="bank">
									</div>
									<div class="bank_box">
										<span>계좌번호</span>
										<input type="text" id="account_num" name="account_num">
									</div>
									<div class="bank_box">
										<span>예금주</span>
										<input type="text" id="account_name" name="account_name">
									</div>
								</td>
							</tr>
							<tr>
								<th colspan="1">납품처 주소</th>
								<td colspan="7">
									<input type="text" class="od_post insearch" id="od_post" name="od_post" style="width: 30%;" readonly>
									<input type="text" id="od_address" name="od_address" style="width: 80%;" readonly>
									<input type="text" id="od_address2" name="od_address2" style="width: 80%;">
									<label for="od_addr" class="error"></label>
								</td>
							</tr>
						</tbody>
					</table>
					<table class="table_ri" id="table">
		   				<thead>
		   					<tr>
		   						<th id="add_row2" style="cursor: pointer;">추가</th>
		   						<th>제품번호/제품명</th>
		   						<th>규격/단위</th>
		   						<th>포장지당 중량<br>BOX당 수량</th>
		   						<th>BOX 수주수량</th>
		   						<th>낱개수량</th>
		   						<th>수주수량</th>
		   						<th>단가</th>
		   						<th>공급가액</th>
		   						<th>부가세</th>
		   						<th>합계</th>
		   						<th>보유 재고량<br>필요 재고량</th>
		   					</tr>
		   				</thead>
						<tbody>
		   					<tr>
		   						<td>
		   							<div class="btn_plma btn_number" title="제거">1</div> 
		   							<input type="hidden" name="od_no[]">
		   						</td>
		   						<td>
		   							<input type="text" class="mt_number" name="mt_number[]" readonly>
		   							<input type="text" class="p_name" name="p_name[]" readonly>
		   						</td>
		   						<td>
		   							<input type="text" class="standard" readonly>
		   							<input type="text" class="p_unit" readonly>
		   						</td>
		   						<td>
		   							<input type="text" class="sacks_unit" readonly>
		   							<input type="text" class="box_quantity" readonly>
		   						</td>
		   						<td><input type="text" class="quantity3" name="quantity3[]"></td>
		   						<td><input type="text" class="quantity2" name="quantity2[]" ></td>
		   						<td><input type="text" class="quantity" name="quantity[]"></td>
		   						<td><input type="text" class="p_price" name="p_price[]" readonly></td>
		   						<td><input type="text" class="price_sum" name="price_sum[]" readonly></td>
		   						<td><input type="text" class="vat_sum" name="vat_sum[]" readonly></td>
		   						<td><input type="text" class="total_sum" name="total_sum[]" readonly></td>
		   						<td><input type='text' class='stock' readonly></td>
		   					</tr>
						</tbody>
					</table>
					<div class="bot_box">
						<div class="bot_btn">
							<div class="btn"><a href="/obtain_order/pr_or_check.html">취소</a></div>
							<div class="btn btn_right save" title="수정">수정</div>
						</div>
						<!-- bot_btn -->
					</div>
					<!-- bot_box -->
				</div>
				<!--con-->
				<div id="lay" style="overflow: auto;">
					<div class="bg"></div>
					<div id="lay2"></div>
				</div>
			</div>
			<!--content-->
		</div>
	</div>
	<!--content-->
	<div id="copy">
		<?include "$_SERVER[DOCUMENT_ROOT]/inc/copy_wrap.html";?>
	</div>
	<div class="keyboard"></div>
</body>
</html>